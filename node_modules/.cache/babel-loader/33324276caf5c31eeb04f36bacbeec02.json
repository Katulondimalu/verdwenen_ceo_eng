{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n/**\n * @name photoMagician\n * @author Jinke.Li\n * @github https://www.github.com/lijinke666/\n * 图片滤镜算法代码 参考网上代码\n */\n\n\nvar photoMagician = function () {\n  function photoMagician() {\n    _classCallCheck(this, photoMagician);\n\n    this.colors = {};\n    this.cover = null;\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext(\"2d\"); //图片滤镜\n\n    this.imageFilterType = {\n      vintage: \"vintage\",\n      blackWhite: \"blackWhite\",\n      invert: \"invert\",\n      relief: \"relief\",\n      mirror: \"mirror\",\n      blur: \"blur\"\n    }; //复古 //黑白 //反色 //浮雕 //镜像 //模糊\n\n    this.outputType = {\n      blob: \"blob\",\n      dataUrl: \"dataUrl\"\n    };\n    this.defaultImageQuality = 1.0;\n  }\n\n  photoMagician.prototype.setConfig = function setConfig(_ref) {\n    var imageQuality = _ref.imageQuality;\n    this.defaultImageQuality = imageQuality;\n  };\n\n  photoMagician.prototype.createImageNode = function createImageNode(cover, canvasWidth, canvasHeight) {\n    var _this = this;\n\n    return new Promise(function (res, rej) {\n      var coverType = typeof cover === \"undefined\" ? \"undefined\" : _typeof(cover);\n\n      if (Object.is(coverType, \"object\")) {\n        _this.setCanvasWidth(canvasWidth, canvasHeight);\n\n        res(cover);\n      } else if (Object.is(coverType, \"string\")) {\n        var img = new Image();\n        img.src = cover;\n        img.crossOrigin = \"Anonymous\"; //支持图片跨域\n\n        img.onload = function () {\n          var suffix = _this.getCoverExt(cover);\n\n          _this.setCanvasWidth(canvasWidth || img.width, canvasHeight || img.height);\n\n          res({\n            suffix: suffix,\n            img: img\n          });\n        };\n\n        img.onerror = rej;\n      } else {\n        var errText = \"The cover options is not a String of Object\\n\";\n        rej(errText);\n        throw new Error(errText);\n      }\n    });\n  };\n\n  photoMagician.prototype.getCoverExt = function getCoverExt(cover) {\n    this.checkCoverType(cover);\n    return cover.replace(/.*\\.(jpg|jpeg|png|gif)/, \"$1\");\n  };\n\n  photoMagician.prototype.setCanvasWidth = function setCanvasWidth(width, height) {\n    this.canvas.width = width;\n    this.canvas.height = height;\n  };\n\n  photoMagician.prototype.checkCoverType = function checkCoverType(cover) {\n    if (!Object.is(typeof cover === \"undefined\" ? \"undefined\" : _typeof(cover), \"string\")) throw new Error('cover can not be empty and it must be \"string\"');\n  };\n\n  photoMagician.prototype.getUrl = function getUrl() {\n    var _this2 = this;\n\n    var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref2$outputType = _ref2.outputType,\n        outputType = _ref2$outputType === undefined ? this.outputType.dataUrl : _ref2$outputType,\n        suffix = _ref2.suffix,\n        _ref2$quality = _ref2.quality,\n        quality = _ref2$quality === undefined ? this.defaultImageQuality : _ref2$quality,\n        _ref2$canvas = _ref2.canvas,\n        canvas = _ref2$canvas === undefined ? this.canvas : _ref2$canvas;\n\n    return new Promise(function (res, rej) {\n      var outputTypes = Object.values(_this2.outputType);\n\n      if (!outputTypes.includes(outputType)) {\n        var errMsg = \"invalid output type, one of \" + outputType.join(\"|\");\n        rej(errMsg);\n        throw new Error(errMsg);\n      }\n\n      if (outputType === _this2.outputType.dataUrl) {\n        res(canvas.toDataURL(\"image/\" + suffix), quality);\n      }\n\n      canvas.toBlob(res, \"image/\" + suffix, quality);\n    });\n  };\n  /**\n   * 添加水印\n   * @param {Object} options\n   * @param {String} cover 目标图片 必选\n   * @param {String} waterMark 水印 (文本或图片地址) 必选\n   * @param {String} mode 水印模式 非必选  text | image 默认 \"text\"\n   * @param {Boolean} fontBold 文本水印加粗 (文字水印时有效) 非必选 默认 true\n   * @param {Number} fontSize 文本字体大小 (文字水印时有效) 非必选 默认 20\n   * @param {String} fontColor 文本水印颜色 (文字水印时有效) 非必选 默认 'rgba(255,255,255,.5)'\n   * @param {Number} width 图片水印长度 (图片水印时有效) 非必选 默认 '50'\n   * @param {NUmber} height 图片水印高度 (图片水印时有效) 非必选 默认 '50'\n   */\n\n\n  photoMagician.prototype.addWaterMark = function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n      var _ref4 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref4.cover,\n          _ref4$coordinate = _ref4.coordinate,\n          coordinate = _ref4$coordinate === undefined ? [0, 0] : _ref4$coordinate,\n          _ref4$fontBold = _ref4.fontBold,\n          fontBold = _ref4$fontBold === undefined ? true : _ref4$fontBold,\n          _ref4$fontSize = _ref4.fontSize,\n          fontSize = _ref4$fontSize === undefined ? 20 : _ref4$fontSize,\n          _ref4$fontColor = _ref4.fontColor,\n          fontColor = _ref4$fontColor === undefined ? \"rgba(255,255,255,.5)\" : _ref4$fontColor,\n          _ref4$mode = _ref4.mode,\n          mode = _ref4$mode === undefined ? \"text\" : _ref4$mode,\n          _ref4$width = _ref4.width,\n          width = _ref4$width === undefined ? 50 : _ref4$width,\n          _ref4$height = _ref4.height,\n          height = _ref4$height === undefined ? 50 : _ref4$height,\n          _ref4$opacity = _ref4.opacity,\n          opacity = _ref4$opacity === undefined ? 0.5 : _ref4$opacity,\n          waterMark = _ref4.waterMark,\n          outputType = _ref4.outputType;\n\n      var isTextMode, isImageMode, sx, sy, _ref5, img, suffix, _ref6, waterMarkImg;\n\n      return _regenerator2.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!Array.isArray(coordinate) || coordinate.length !== 2)) {\n                _context.next = 2;\n                break;\n              }\n\n              throw new Error(\"coordinate must be a array. like [x,y]\");\n\n            case 2:\n              isTextMode = Object.is(mode, \"text\");\n              isImageMode = Object.is(mode, \"image\");\n\n              if (waterMark) {\n                _context.next = 6;\n                break;\n              }\n\n              throw new Error(\"waterMark is required.\");\n\n            case 6:\n              if (!(!isTextMode && !isImageMode)) {\n                _context.next = 8;\n                break;\n              }\n\n              throw new Error('mode it must be \"text\" of \"image\" .');\n\n            case 8:\n              sx = coordinate[0], sy = coordinate[1];\n              _context.next = 11;\n              return this.createImageNode(cover);\n\n            case 11:\n              _ref5 = _context.sent;\n              img = _ref5.img;\n              suffix = _ref5.suffix;\n              this.waterMarkCanvas = document.createElement(\"canvas\");\n              this.waterMarkCtx = this.waterMarkCanvas.getContext(\"2d\"); //绘制图片水印\n\n              if (!isImageMode) {\n                _context.next = 25;\n                break;\n              }\n\n              _context.next = 19;\n              return this.createImageNode(waterMark, img.width, img.height);\n\n            case 19:\n              _ref6 = _context.sent;\n              waterMarkImg = _ref6.img;\n              this.waterMarkCanvas.width = width;\n              this.waterMarkCanvas.height = height;\n              this.waterMarkCtx.globalAlpha = opacity;\n              this.waterMarkCtx.drawImage(waterMarkImg, 0, 0, this.waterMarkCanvas.width, this.waterMarkCanvas.height);\n\n            case 25:\n              //绘制文本水印\n              if (isTextMode) {\n                this.waterMarkCtx.font = (fontBold ? \"bold\" : \"\") + \" \" + fontSize + (/.*px$/.test(fontSize) ? \"\" : \"px\") + \" Microsoft YaHei\";\n                this.waterMarkCtx.fillStyle = fontColor;\n                this.waterMarkCtx.textBaseline = \"middle\";\n                this.waterMarkCtx.fillText(waterMark, sx, sy);\n              } //离屏渲染\n\n\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              this.ctx.drawImage(this.waterMarkCanvas, sx, sy, isImageMode ? this.waterMarkCanvas.width : img.width, isImageMode ? this.waterMarkCanvas.height : img.height);\n              _context.next = 30;\n              return this.getUrl({\n                outputType: outputType,\n                suffix: suffix\n              });\n\n            case 30:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 31:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function addWaterMark() {\n      return _ref3.apply(this, arguments);\n    }\n\n    return addWaterMark;\n  }();\n  /**\n   * 裁剪图片\n   * @param {object} Options\n   * @param {String} cover 图片 必选\n   * @param {Number} scale 缩放比例  非必选 默认 1.0 不缩放\n   * @param {Array} coordinate 裁剪坐标  必选  [[x1,y1],[x2,y2]]\n   * @return 裁剪后的图片节点\n   */\n\n\n  photoMagician.prototype.clipImage = function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n      var _ref8 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref8.cover,\n          _ref8$scale = _ref8.scale,\n          scale = _ref8$scale === undefined ? 1.0 : _ref8$scale,\n          _ref8$coordinate = _ref8.coordinate,\n          coordinate = _ref8$coordinate === undefined ? [] : _ref8$coordinate,\n          outputType = _ref8.outputType;\n\n      var xy1, xy2, x1, y1, x2, y2, clipWidth, clipHeight, _ref9, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!coordinate.some(function (value) {\n                return !Array.isArray(value) || value.length !== 2;\n              })) {\n                _context2.next = 2;\n                break;\n              }\n\n              throw new Error(\"coordinate must be a array, like [[x1,y1],[x2,y2]]\");\n\n            case 2:\n              if (Object.is(typeof scale === \"undefined\" ? \"undefined\" : _typeof(scale), \"number\")) {\n                _context2.next = 4;\n                break;\n              }\n\n              throw new Error(\"scale must be a number.\");\n\n            case 4:\n              xy1 = coordinate[0], xy2 = coordinate[1];\n              x1 = xy1[0], y1 = xy1[1];\n              x2 = xy2[0], y2 = xy2[1];\n              clipWidth = Math.abs(x2 - x1);\n              clipHeight = Math.abs(y2 - y1);\n              _context2.next = 11;\n              return this.createImageNode(cover, clipWidth, clipHeight);\n\n            case 11:\n              _ref9 = _context2.sent;\n              img = _ref9.img;\n              suffix = _ref9.suffix;\n              this.ctx.drawImage(img, x1 / scale, y1 / scale, clipWidth / scale, clipHeight / scale, 0, 0, clipWidth, clipHeight);\n              _context2.next = 17;\n              return this.getUrl({\n                outputType: outputType,\n                suffix: suffix\n              });\n\n            case 17:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 18:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    function clipImage() {\n      return _ref7.apply(this, arguments);\n    }\n\n    return clipImage;\n  }(); //拷贝图片像素信息\n\n\n  photoMagician.prototype.copyImageData = function copyImageData() {\n    var _ref10 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        width = _ref10.width,\n        height = _ref10.height,\n        data = _ref10.data;\n\n    var copyData = this.ctx.createImageData(width, height);\n    copyData.data.set(data);\n    return copyData;\n  }; //获取图片像素信息\n\n\n  photoMagician.prototype.transFormImageData = function () {\n    var _ref11 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee3(filterType, suffix, outputType) {\n      var imageData, data, canvasArea, tempData, sumred, sumgreen, sumblue, i, r, g, b, grey, _i, _r, _g, _b, color, _grey, _i2, _r2, _g2, _b2, x, y, idx, bidx, aidx, nr, ng, nb, _x8, _y, _idx, midx, _x9, _y2, _idx2, subCol, colOff, subRow, rowOff, idx2, _r3, _g3, _b3, _nr, _ng, _nb;\n\n      return _regenerator2.default.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              //每一个像素由4个元素组成  分别是  r g b a\n              //所以 第 i 个元素  是\n              //r = pixelData[ i*4 +0 ];\n              //g = pixelData[ i*4 +1 ];\n              //b = pixelData[ i*4 +2 ];\n              //a = pixelData[ i*4 +3 ];\n              this.filterCanvas = document.createElement(\"canvas\");\n              this.filterCtx = this.filterCanvas.getContext(\"2d\");\n              this.filterCanvas.width = this.canvas.width;\n              this.filterCanvas.height = this.canvas.height;\n              imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height); //像素信息\n\n              data = imageData.data;\n              canvasArea = this.canvas.width * this.canvas.height;\n              tempData = this.copyImageData(imageData);\n              sumred = 0.0, sumgreen = 0.0, sumblue = 0.0;\n              _context3.t0 = filterType;\n              _context3.next = _context3.t0 === this.imageFilterType[\"vintage\"] ? 12 : _context3.t0 === this.imageFilterType[\"blackWhite\"] ? 14 : _context3.t0 === this.imageFilterType[\"invert\"] ? 16 : _context3.t0 === this.imageFilterType[\"relief\"] ? 18 : _context3.t0 === this.imageFilterType[\"mirror\"] ? 20 : _context3.t0 === this.imageFilterType[\"blur\"] ? 22 : 24;\n              break;\n\n            case 12:\n              for (i = 0; i < canvasArea; i++) {\n                r = data[i * 4], g = data[i * 4 + 1], b = data[i * 4] + 2; //国际 最佳灰色图像算法\n\n                grey = r * 0.3 + g * 0.59 + b * 0.11;\n                data[i * 4] = grey;\n                data[i * 4 + 1] = grey;\n                data[i * 4 + 2] = grey;\n              }\n\n              return _context3.abrupt(\"break\", 24);\n\n            case 14:\n              for (_i = 0; _i < canvasArea; _i++) {\n                _r = data[_i * 4], _g = data[_i * 4 + 1], _b = data[_i * 4] + 2, color = null;\n                _grey = _r * 0.3 + _g * 0.59 + _b * 0.11;\n\n                if (_grey > 255 / 2) {\n                  color = 255;\n                } else {\n                  color = 0;\n                }\n\n                data[_i * 4] = color;\n                data[_i * 4 + 1] = color;\n                data[_i * 4 + 2] = color;\n              }\n\n              return _context3.abrupt(\"break\", 24);\n\n            case 16:\n              for (_i2 = 0; _i2 < canvasArea; _i2 += 4) {\n                _r2 = data[_i2], _g2 = data[_i2 + 1], _b2 = data[_i2 + 2];\n                data[_i2] = 255 - _r2;\n                data[_i2 + 1] = 255 - _g2;\n                data[_i2 + 2] = 255 - _b2;\n              }\n\n              return _context3.abrupt(\"break\", 24);\n\n            case 18:\n              for (x = 1; x < tempData.width - 1; x++) {\n                for (y = 1; y < tempData.height - 1; y++) {\n                  idx = (x + y * tempData.width) * 4, bidx = (x - 1 + y * tempData.width) * 4, aidx = (x + 1 + y * tempData.width) * 4;\n                  nr = tempData.data[aidx + 0] - tempData.data[bidx + 0] + 128;\n                  ng = tempData.data[aidx + 1] - tempData.data[bidx + 1] + 128;\n                  nb = tempData.data[aidx + 2] - tempData.data[bidx + 2] + 128;\n                  nr = nr < 0 ? 0 : nr > 255 ? 255 : nr;\n                  ng = ng < 0 ? 0 : ng > 255 ? 255 : ng;\n                  nb = nb < 0 ? 0 : nb > 255 ? 255 : nb;\n                  data[idx + 0] = nr;\n                  data[idx + 1] = ng;\n                  data[idx + 2] = nb;\n                  data[idx + 3] = 255;\n                }\n              }\n\n              return _context3.abrupt(\"break\", 24);\n\n            case 20:\n              for (_x8 = 0; _x8 < tempData.width; _x8++) {\n                for (_y = 0; _y < tempData.height; _y++) {\n                  _idx = (_x8 + _y * tempData.width) * 4;\n                  midx = (tempData.width - 1 - _x8 + _y * tempData.width) * 4;\n                  data[midx + 0] = data[_idx + 0];\n                  data[midx + 1] = data[_idx + 1];\n                  data[midx + 2] = data[_idx + 2];\n                  data[midx + 3] = 255;\n                }\n              }\n\n              return _context3.abrupt(\"break\", 24);\n\n            case 22:\n              for (_x9 = 0; _x9 < tempData.width; _x9++) {\n                for (_y2 = 0; _y2 < tempData.height; _y2++) {\n                  // Index of the pixel in the array\n                  _idx2 = (_x9 + _y2 * tempData.width) * 4;\n\n                  for (subCol = -2; subCol <= 2; subCol++) {\n                    colOff = subCol + _x9;\n\n                    if (colOff < 0 || colOff >= tempData.width) {\n                      colOff = 0;\n                    }\n\n                    for (subRow = -2; subRow <= 2; subRow++) {\n                      rowOff = subRow + _y2;\n\n                      if (rowOff < 0 || rowOff >= tempData.height) {\n                        rowOff = 0;\n                      }\n\n                      idx2 = (colOff + rowOff * tempData.width) * 4;\n                      _r3 = tempData.data[idx2 + 0];\n                      _g3 = tempData.data[idx2 + 1];\n                      _b3 = tempData.data[idx2 + 2];\n                      sumred += _r3;\n                      sumgreen += _g3;\n                      sumblue += _b3;\n                    }\n                  } // calculate new RGB value\n\n\n                  _nr = sumred / 25.0;\n                  _ng = sumgreen / 25.0;\n                  _nb = sumblue / 25.0; // clear previous for next pixel point\n\n                  sumred = 0.0;\n                  sumgreen = 0.0;\n                  sumblue = 0.0; // assign new pixel value\n\n                  data[_idx2 + 0] = _nr; // Red channel\n\n                  data[_idx2 + 1] = _ng; // Green channel\n\n                  data[_idx2 + 2] = _nb; // Blue channel\n\n                  data[_idx2 + 3] = 255; // Alpha channel\n                }\n              }\n\n              return _context3.abrupt(\"break\", 24);\n\n            case 24:\n              this.filterCtx.putImageData(imageData, 0, 0, 0, 0, this.filterCanvas.width, this.filterCanvas.height);\n              _context3.next = 27;\n              return this.getUrl({\n                outputType: outputType,\n                suffix: suffix,\n                canvas: this.filterCanvas\n              });\n\n            case 27:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 28:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n\n    function transFormImageData(_x5, _x6, _x7) {\n      return _ref11.apply(this, arguments);\n    }\n\n    return transFormImageData;\n  }();\n  /**\n   * 图片滤镜\n   * @param {Object} options\n   * @param {String} mode 滤镜名字 非必须 默认 复古 'vintage'\n   */\n\n\n  photoMagician.prototype.addImageFilter = function () {\n    var _ref12 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n      var _ref13 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref13.cover,\n          _ref13$mode = _ref13.mode,\n          mode = _ref13$mode === undefined ? this.imageFilterType[\"vintage\"] : _ref13$mode,\n          outputType = _ref13.outputType;\n\n      var imageFilterConfig, _ref14, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              imageFilterConfig = Object.values(this.imageFilterType);\n\n              if (imageFilterConfig.includes(mode)) {\n                _context4.next = 3;\n                break;\n              }\n\n              throw new Error(\"mode must one of [\" + imageFilterConfig.join(\",\") + \"]\");\n\n            case 3:\n              _context4.next = 5;\n              return this.createImageNode(cover);\n\n            case 5:\n              _ref14 = _context4.sent;\n              img = _ref14.img;\n              suffix = _ref14.suffix;\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              return _context4.abrupt(\"return\", this.transFormImageData(mode, suffix, outputType));\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n\n    function addImageFilter() {\n      return _ref12.apply(this, arguments);\n    }\n\n    return addImageFilter;\n  }();\n  /**\n   * 旋转图片\n   * @param {String | Object} cover 图片\n   * @param {Number} rotate 旋转比例 (0 -360 ) deg\n   */\n\n\n  photoMagician.prototype.rotateImage = function () {\n    var _ref15 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n      var _ref16 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref16.cover,\n          _ref16$rotate = _ref16.rotate,\n          rotate = _ref16$rotate === undefined ? 0 : _ref16$rotate,\n          outputType = _ref16.outputType;\n\n      var _ref17, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (Object.is(typeof rotate === \"undefined\" ? \"undefined\" : _typeof(rotate), \"number\")) {\n                _context5.next = 2;\n                break;\n              }\n\n              throw new Error(\"rotate must be a number.\");\n\n            case 2:\n              _context5.next = 4;\n              return this.createImageNode(cover);\n\n            case 4:\n              _ref17 = _context5.sent;\n              img = _ref17.img;\n              suffix = _ref17.suffix;\n              this.ctx.save();\n              this.ctx.rotate(rotate * Math.PI / 180);\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              this.ctx.restore();\n              _context5.next = 13;\n              return this.getUrl({\n                outputType: outputType,\n                suffix: suffix\n              });\n\n            case 13:\n              return _context5.abrupt(\"return\", _context5.sent);\n\n            case 14:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    function rotateImage() {\n      return _ref15.apply(this, arguments);\n    }\n\n    return rotateImage;\n  }();\n  /**\n   * 图片 转base64\n   * @param {Object} options\n   * @param {String | Object} cover 图片地址\n   * @return 图片base64 data\n   */\n\n\n  photoMagician.prototype.toBase64Url = function () {\n    var _ref18 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee6(_ref19) {\n      var cover = _ref19.cover,\n          outputType = _ref19.outputType;\n\n      var _ref20, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return this.createImageNode(cover);\n\n            case 2:\n              _ref20 = _context6.sent;\n              img = _ref20.img;\n              suffix = _ref20.suffix;\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              _context6.next = 8;\n              return this.getUrl({\n                outputType: outputType,\n                suffix: suffix\n              });\n\n            case 8:\n              return _context6.abrupt(\"return\", _context6.sent);\n\n            case 9:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    function toBase64Url(_x12) {\n      return _ref18.apply(this, arguments);\n    }\n\n    return toBase64Url;\n  }();\n  /**\n   * 压缩图片\n   * @param {Object} options\n   * @param {String | Object} cover 图片地址 | 图片节点 必选\n   * @param {Number}  quality 压缩比例  非必选 默认 '0.92'\n   * @return 压缩后的图片节点\n   */\n\n\n  photoMagician.prototype.compressImage = function () {\n    var _ref21 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n      var _ref22 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref22.cover,\n          _ref22$quality = _ref22.quality,\n          quality = _ref22$quality === undefined ? 0.92 : _ref22$quality,\n          outputType = _ref22.outputType;\n\n      var _ref23, img, _quality, suffix;\n\n      return _regenerator2.default.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (Object.is(typeof quality === \"undefined\" ? \"undefined\" : _typeof(quality), \"number\")) {\n                _context7.next = 2;\n                break;\n              }\n\n              throw new Error(\"quality must be a number.\");\n\n            case 2:\n              _context7.next = 4;\n              return this.createImageNode(cover);\n\n            case 4:\n              _ref23 = _context7.sent;\n              img = _ref23.img;\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              _quality = Number(quality);\n              suffix = _quality === 0.92 ? \"png\" : \"jpeg\";\n              _context7.next = 11;\n              return this.getUrl({\n                outputType: outputType,\n                suffix: suffix,\n                quality: _quality\n              });\n\n            case 11:\n              return _context7.abrupt(\"return\", _context7.sent);\n\n            case 12:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    function compressImage() {\n      return _ref21.apply(this, arguments);\n    }\n\n    return compressImage;\n  }();\n\n  photoMagician.prototype.getPrimaryColor = function () {\n    var _ref24 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n      var _ref25 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref25.cover;\n\n      var _ref26, img, _ctx$getImageData, data, imgDataWidth, imgDataHeight, section, i, len, _ref27, r, g, b, a, rgba;\n\n      return _regenerator2.default.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return this.createImageNode(cover);\n\n            case 2:\n              _ref26 = _context8.sent;\n              img = _ref26.img;\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              _ctx$getImageData = this.ctx.getImageData(0, 0, img.width, img.height), data = _ctx$getImageData.data, imgDataWidth = _ctx$getImageData.width, imgDataHeight = _ctx$getImageData.height;\n              section = imgDataWidth * imgDataHeight;\n\n              for (i = 0, len = section; i < len; i++) {\n                _ref27 = [data[i * 4], data[i * 4 + 1], data[i * 4 + 2], data[i * 4 + 3]], r = _ref27[0], g = _ref27[1], b = _ref27[2], a = _ref27[3];\n                rgba = \"rgba(\" + r + \",\" + g + \",\" + b + \",\" + a + \")\";\n\n                if (this.colors[rgba]) {\n                  this.colors[rgba].num++;\n                } else {\n                  this.colors[rgba] = {\n                    color: rgba,\n                    num: 1\n                  };\n                }\n              }\n\n              return _context8.abrupt(\"return\", this.getMaxPixelDensity(this.colors));\n\n            case 9:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8, this);\n    }));\n\n    function getPrimaryColor() {\n      return _ref24.apply(this, arguments);\n    }\n\n    return getPrimaryColor;\n  }();\n\n  photoMagician.prototype.getMaxPixelDensity = function getMaxPixelDensity(data) {\n    var sort = Object.values(data).sort(function (a, b) {\n      return a.num - b.num;\n    });\n    return sort[sort.length - 1][\"color\"];\n  };\n\n  return photoMagician;\n}();\n\nexports.default = photoMagician;","map":{"version":3,"names":["Object","defineProperty","exports","value","_regenerator","require","_regenerator2","_interopRequireDefault","_typeof","Symbol","iterator","obj","constructor","prototype","__esModule","default","_asyncToGenerator","fn","gen","apply","arguments","Promise","resolve","reject","step","key","arg","info","error","done","then","err","_classCallCheck","instance","Constructor","TypeError","photoMagician","colors","cover","canvas","document","createElement","ctx","getContext","imageFilterType","vintage","blackWhite","invert","relief","mirror","blur","outputType","blob","dataUrl","defaultImageQuality","setConfig","_ref","imageQuality","createImageNode","canvasWidth","canvasHeight","_this","res","rej","coverType","is","setCanvasWidth","img","Image","src","crossOrigin","onload","suffix","getCoverExt","width","height","onerror","errText","Error","checkCoverType","replace","getUrl","_this2","_ref2","length","undefined","_ref2$outputType","_ref2$quality","quality","_ref2$canvas","outputTypes","values","includes","errMsg","join","toDataURL","toBlob","addWaterMark","_ref3","mark","_callee","_ref4","_ref4$coordinate","coordinate","_ref4$fontBold","fontBold","_ref4$fontSize","fontSize","_ref4$fontColor","fontColor","_ref4$mode","mode","_ref4$width","_ref4$height","_ref4$opacity","opacity","waterMark","isTextMode","isImageMode","sx","sy","_ref5","_ref6","waterMarkImg","wrap","_callee$","_context","prev","next","Array","isArray","sent","waterMarkCanvas","waterMarkCtx","globalAlpha","drawImage","font","test","fillStyle","textBaseline","fillText","abrupt","stop","clipImage","_ref7","_callee2","_ref8","_ref8$scale","scale","_ref8$coordinate","xy1","xy2","x1","y1","x2","y2","clipWidth","clipHeight","_ref9","_callee2$","_context2","some","Math","abs","copyImageData","_ref10","data","copyData","createImageData","set","transFormImageData","_ref11","_callee3","filterType","imageData","canvasArea","tempData","sumred","sumgreen","sumblue","i","r","g","b","grey","_i","_r","_g","_b","color","_grey","_i2","_r2","_g2","_b2","x","y","idx","bidx","aidx","nr","ng","nb","_x8","_y","_idx","midx","_x9","_y2","_idx2","subCol","colOff","subRow","rowOff","idx2","_r3","_g3","_b3","_nr","_ng","_nb","_callee3$","_context3","filterCanvas","filterCtx","getImageData","t0","putImageData","_x5","_x6","_x7","addImageFilter","_ref12","_callee4","_ref13","_ref13$mode","imageFilterConfig","_ref14","_callee4$","_context4","rotateImage","_ref15","_callee5","_ref16","_ref16$rotate","rotate","_ref17","_callee5$","_context5","save","PI","restore","toBase64Url","_ref18","_callee6","_ref19","_ref20","_callee6$","_context6","_x12","compressImage","_ref21","_callee7","_ref22","_ref22$quality","_ref23","_quality","_callee7$","_context7","Number","getPrimaryColor","_ref24","_callee8","_ref25","_ref26","_ctx$getImageData","imgDataWidth","imgDataHeight","section","len","_ref27","a","rgba","_callee8$","_context8","num","getMaxPixelDensity","sort"],"sources":["/Users/stichtinghelden/Documents/GitHub/patient_0_eng/patient0eng/node_modules/photo-magician/lib/index.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * @name photoMagician\n * @author Jinke.Li\n * @github https://www.github.com/lijinke666/\n * 图片滤镜算法代码 参考网上代码\n */\n\nvar photoMagician = function () {\n  function photoMagician() {\n    _classCallCheck(this, photoMagician);\n\n    this.colors = {};\n    this.cover = null;\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext(\"2d\");\n    //图片滤镜\n    this.imageFilterType = {\n      vintage: \"vintage\",\n      blackWhite: \"blackWhite\",\n      invert: \"invert\",\n      relief: \"relief\",\n      mirror: \"mirror\",\n      blur: \"blur\"\n    }; //复古 //黑白 //反色 //浮雕 //镜像 //模糊\n    this.outputType = { blob: \"blob\", dataUrl: \"dataUrl\" };\n    this.defaultImageQuality = 1.0;\n  }\n\n  photoMagician.prototype.setConfig = function setConfig(_ref) {\n    var imageQuality = _ref.imageQuality;\n\n    this.defaultImageQuality = imageQuality;\n  };\n\n  photoMagician.prototype.createImageNode = function createImageNode(cover, canvasWidth, canvasHeight) {\n    var _this = this;\n\n    return new Promise(function (res, rej) {\n      var coverType = typeof cover === \"undefined\" ? \"undefined\" : _typeof(cover);\n      if (Object.is(coverType, \"object\")) {\n        _this.setCanvasWidth(canvasWidth, canvasHeight);\n        res(cover);\n      } else if (Object.is(coverType, \"string\")) {\n        var img = new Image();\n        img.src = cover;\n        img.crossOrigin = \"Anonymous\"; //支持图片跨域\n        img.onload = function () {\n          var suffix = _this.getCoverExt(cover);\n          _this.setCanvasWidth(canvasWidth || img.width, canvasHeight || img.height);\n          res({ suffix: suffix, img: img });\n        };\n        img.onerror = rej;\n      } else {\n        var errText = \"The cover options is not a String of Object\\n\";\n        rej(errText);\n        throw new Error(errText);\n      }\n    });\n  };\n\n  photoMagician.prototype.getCoverExt = function getCoverExt(cover) {\n    this.checkCoverType(cover);\n    return cover.replace(/.*\\.(jpg|jpeg|png|gif)/, \"$1\");\n  };\n\n  photoMagician.prototype.setCanvasWidth = function setCanvasWidth(width, height) {\n    this.canvas.width = width;\n    this.canvas.height = height;\n  };\n\n  photoMagician.prototype.checkCoverType = function checkCoverType(cover) {\n    if (!Object.is(typeof cover === \"undefined\" ? \"undefined\" : _typeof(cover), \"string\")) throw new Error('cover can not be empty and it must be \"string\"');\n  };\n\n  photoMagician.prototype.getUrl = function getUrl() {\n    var _this2 = this;\n\n    var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref2$outputType = _ref2.outputType,\n        outputType = _ref2$outputType === undefined ? this.outputType.dataUrl : _ref2$outputType,\n        suffix = _ref2.suffix,\n        _ref2$quality = _ref2.quality,\n        quality = _ref2$quality === undefined ? this.defaultImageQuality : _ref2$quality,\n        _ref2$canvas = _ref2.canvas,\n        canvas = _ref2$canvas === undefined ? this.canvas : _ref2$canvas;\n\n    return new Promise(function (res, rej) {\n      var outputTypes = Object.values(_this2.outputType);\n      if (!outputTypes.includes(outputType)) {\n        var errMsg = \"invalid output type, one of \" + outputType.join(\"|\");\n        rej(errMsg);\n        throw new Error(errMsg);\n      }\n      if (outputType === _this2.outputType.dataUrl) {\n        res(canvas.toDataURL(\"image/\" + suffix), quality);\n      }\n      canvas.toBlob(res, \"image/\" + suffix, quality);\n    });\n  };\n  /**\n   * 添加水印\n   * @param {Object} options\n   * @param {String} cover 目标图片 必选\n   * @param {String} waterMark 水印 (文本或图片地址) 必选\n   * @param {String} mode 水印模式 非必选  text | image 默认 \"text\"\n   * @param {Boolean} fontBold 文本水印加粗 (文字水印时有效) 非必选 默认 true\n   * @param {Number} fontSize 文本字体大小 (文字水印时有效) 非必选 默认 20\n   * @param {String} fontColor 文本水印颜色 (文字水印时有效) 非必选 默认 'rgba(255,255,255,.5)'\n   * @param {Number} width 图片水印长度 (图片水印时有效) 非必选 默认 '50'\n   * @param {NUmber} height 图片水印高度 (图片水印时有效) 非必选 默认 '50'\n   */\n\n\n  photoMagician.prototype.addWaterMark = function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n      var _ref4 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref4.cover,\n          _ref4$coordinate = _ref4.coordinate,\n          coordinate = _ref4$coordinate === undefined ? [0, 0] : _ref4$coordinate,\n          _ref4$fontBold = _ref4.fontBold,\n          fontBold = _ref4$fontBold === undefined ? true : _ref4$fontBold,\n          _ref4$fontSize = _ref4.fontSize,\n          fontSize = _ref4$fontSize === undefined ? 20 : _ref4$fontSize,\n          _ref4$fontColor = _ref4.fontColor,\n          fontColor = _ref4$fontColor === undefined ? \"rgba(255,255,255,.5)\" : _ref4$fontColor,\n          _ref4$mode = _ref4.mode,\n          mode = _ref4$mode === undefined ? \"text\" : _ref4$mode,\n          _ref4$width = _ref4.width,\n          width = _ref4$width === undefined ? 50 : _ref4$width,\n          _ref4$height = _ref4.height,\n          height = _ref4$height === undefined ? 50 : _ref4$height,\n          _ref4$opacity = _ref4.opacity,\n          opacity = _ref4$opacity === undefined ? 0.5 : _ref4$opacity,\n          waterMark = _ref4.waterMark,\n          outputType = _ref4.outputType;\n\n      var isTextMode, isImageMode, sx, sy, _ref5, img, suffix, _ref6, waterMarkImg;\n\n      return _regenerator2.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!Array.isArray(coordinate) || coordinate.length !== 2)) {\n                _context.next = 2;\n                break;\n              }\n\n              throw new Error(\"coordinate must be a array. like [x,y]\");\n\n            case 2:\n              isTextMode = Object.is(mode, \"text\");\n              isImageMode = Object.is(mode, \"image\");\n\n              if (waterMark) {\n                _context.next = 6;\n                break;\n              }\n\n              throw new Error(\"waterMark is required.\");\n\n            case 6:\n              if (!(!isTextMode && !isImageMode)) {\n                _context.next = 8;\n                break;\n              }\n\n              throw new Error('mode it must be \"text\" of \"image\" .');\n\n            case 8:\n              sx = coordinate[0], sy = coordinate[1];\n              _context.next = 11;\n              return this.createImageNode(cover);\n\n            case 11:\n              _ref5 = _context.sent;\n              img = _ref5.img;\n              suffix = _ref5.suffix;\n\n              this.waterMarkCanvas = document.createElement(\"canvas\");\n              this.waterMarkCtx = this.waterMarkCanvas.getContext(\"2d\");\n\n              //绘制图片水印\n\n              if (!isImageMode) {\n                _context.next = 25;\n                break;\n              }\n\n              _context.next = 19;\n              return this.createImageNode(waterMark, img.width, img.height);\n\n            case 19:\n              _ref6 = _context.sent;\n              waterMarkImg = _ref6.img;\n\n              this.waterMarkCanvas.width = width;\n              this.waterMarkCanvas.height = height;\n              this.waterMarkCtx.globalAlpha = opacity;\n              this.waterMarkCtx.drawImage(waterMarkImg, 0, 0, this.waterMarkCanvas.width, this.waterMarkCanvas.height);\n\n            case 25:\n\n              //绘制文本水印\n              if (isTextMode) {\n                this.waterMarkCtx.font = (fontBold ? \"bold\" : \"\") + \" \" + fontSize + (/.*px$/.test(fontSize) ? \"\" : \"px\") + \" Microsoft YaHei\";\n                this.waterMarkCtx.fillStyle = fontColor;\n                this.waterMarkCtx.textBaseline = \"middle\";\n                this.waterMarkCtx.fillText(waterMark, sx, sy);\n              }\n\n              //离屏渲染\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              this.ctx.drawImage(this.waterMarkCanvas, sx, sy, isImageMode ? this.waterMarkCanvas.width : img.width, isImageMode ? this.waterMarkCanvas.height : img.height);\n\n              _context.next = 30;\n              return this.getUrl({ outputType: outputType, suffix: suffix });\n\n            case 30:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 31:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function addWaterMark() {\n      return _ref3.apply(this, arguments);\n    }\n\n    return addWaterMark;\n  }();\n  /**\n   * 裁剪图片\n   * @param {object} Options\n   * @param {String} cover 图片 必选\n   * @param {Number} scale 缩放比例  非必选 默认 1.0 不缩放\n   * @param {Array} coordinate 裁剪坐标  必选  [[x1,y1],[x2,y2]]\n   * @return 裁剪后的图片节点\n   */\n\n\n  photoMagician.prototype.clipImage = function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n      var _ref8 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref8.cover,\n          _ref8$scale = _ref8.scale,\n          scale = _ref8$scale === undefined ? 1.0 : _ref8$scale,\n          _ref8$coordinate = _ref8.coordinate,\n          coordinate = _ref8$coordinate === undefined ? [] : _ref8$coordinate,\n          outputType = _ref8.outputType;\n\n      var xy1, xy2, x1, y1, x2, y2, clipWidth, clipHeight, _ref9, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!coordinate.some(function (value) {\n                return !Array.isArray(value) || value.length !== 2;\n              })) {\n                _context2.next = 2;\n                break;\n              }\n\n              throw new Error(\"coordinate must be a array, like [[x1,y1],[x2,y2]]\");\n\n            case 2:\n              if (Object.is(typeof scale === \"undefined\" ? \"undefined\" : _typeof(scale), \"number\")) {\n                _context2.next = 4;\n                break;\n              }\n\n              throw new Error(\"scale must be a number.\");\n\n            case 4:\n              xy1 = coordinate[0], xy2 = coordinate[1];\n              x1 = xy1[0], y1 = xy1[1];\n              x2 = xy2[0], y2 = xy2[1];\n              clipWidth = Math.abs(x2 - x1);\n              clipHeight = Math.abs(y2 - y1);\n              _context2.next = 11;\n              return this.createImageNode(cover, clipWidth, clipHeight);\n\n            case 11:\n              _ref9 = _context2.sent;\n              img = _ref9.img;\n              suffix = _ref9.suffix;\n\n\n              this.ctx.drawImage(img, x1 / scale, y1 / scale, clipWidth / scale, clipHeight / scale, 0, 0, clipWidth, clipHeight);\n\n              _context2.next = 17;\n              return this.getUrl({ outputType: outputType, suffix: suffix });\n\n            case 17:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 18:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    function clipImage() {\n      return _ref7.apply(this, arguments);\n    }\n\n    return clipImage;\n  }();\n  //拷贝图片像素信息\n\n\n  photoMagician.prototype.copyImageData = function copyImageData() {\n    var _ref10 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        width = _ref10.width,\n        height = _ref10.height,\n        data = _ref10.data;\n\n    var copyData = this.ctx.createImageData(width, height);\n    copyData.data.set(data);\n    return copyData;\n  };\n  //获取图片像素信息\n\n\n  photoMagician.prototype.transFormImageData = function () {\n    var _ref11 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee3(filterType, suffix, outputType) {\n      var imageData, data, canvasArea, tempData, sumred, sumgreen, sumblue, i, r, g, b, grey, _i, _r, _g, _b, color, _grey, _i2, _r2, _g2, _b2, x, y, idx, bidx, aidx, nr, ng, nb, _x8, _y, _idx, midx, _x9, _y2, _idx2, subCol, colOff, subRow, rowOff, idx2, _r3, _g3, _b3, _nr, _ng, _nb;\n\n      return _regenerator2.default.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              //每一个像素由4个元素组成  分别是  r g b a\n              //所以 第 i 个元素  是\n              //r = pixelData[ i*4 +0 ];\n              //g = pixelData[ i*4 +1 ];\n              //b = pixelData[ i*4 +2 ];\n              //a = pixelData[ i*4 +3 ];\n              this.filterCanvas = document.createElement(\"canvas\");\n              this.filterCtx = this.filterCanvas.getContext(\"2d\");\n              this.filterCanvas.width = this.canvas.width;\n              this.filterCanvas.height = this.canvas.height;\n              imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height); //像素信息\n\n              data = imageData.data;\n              canvasArea = this.canvas.width * this.canvas.height;\n              tempData = this.copyImageData(imageData);\n              sumred = 0.0, sumgreen = 0.0, sumblue = 0.0;\n              _context3.t0 = filterType;\n              _context3.next = _context3.t0 === this.imageFilterType[\"vintage\"] ? 12 : _context3.t0 === this.imageFilterType[\"blackWhite\"] ? 14 : _context3.t0 === this.imageFilterType[\"invert\"] ? 16 : _context3.t0 === this.imageFilterType[\"relief\"] ? 18 : _context3.t0 === this.imageFilterType[\"mirror\"] ? 20 : _context3.t0 === this.imageFilterType[\"blur\"] ? 22 : 24;\n              break;\n\n            case 12:\n              for (i = 0; i < canvasArea; i++) {\n                r = data[i * 4], g = data[i * 4 + 1], b = data[i * 4] + 2;\n                //国际 最佳灰色图像算法\n\n                grey = r * 0.3 + g * 0.59 + b * 0.11;\n\n                data[i * 4] = grey;\n                data[i * 4 + 1] = grey;\n                data[i * 4 + 2] = grey;\n              }\n              return _context3.abrupt(\"break\", 24);\n\n            case 14:\n              for (_i = 0; _i < canvasArea; _i++) {\n                _r = data[_i * 4], _g = data[_i * 4 + 1], _b = data[_i * 4] + 2, color = null;\n                _grey = _r * 0.3 + _g * 0.59 + _b * 0.11;\n\n\n                if (_grey > 255 / 2) {\n                  color = 255;\n                } else {\n                  color = 0;\n                }\n\n                data[_i * 4] = color;\n                data[_i * 4 + 1] = color;\n                data[_i * 4 + 2] = color;\n              }\n              return _context3.abrupt(\"break\", 24);\n\n            case 16:\n              for (_i2 = 0; _i2 < canvasArea; _i2 += 4) {\n                _r2 = data[_i2], _g2 = data[_i2 + 1], _b2 = data[_i2 + 2];\n\n\n                data[_i2] = 255 - _r2;\n                data[_i2 + 1] = 255 - _g2;\n                data[_i2 + 2] = 255 - _b2;\n              }\n              return _context3.abrupt(\"break\", 24);\n\n            case 18:\n              for (x = 1; x < tempData.width - 1; x++) {\n                for (y = 1; y < tempData.height - 1; y++) {\n                  idx = (x + y * tempData.width) * 4, bidx = (x - 1 + y * tempData.width) * 4, aidx = (x + 1 + y * tempData.width) * 4;\n                  nr = tempData.data[aidx + 0] - tempData.data[bidx + 0] + 128;\n                  ng = tempData.data[aidx + 1] - tempData.data[bidx + 1] + 128;\n                  nb = tempData.data[aidx + 2] - tempData.data[bidx + 2] + 128;\n\n\n                  nr = nr < 0 ? 0 : nr > 255 ? 255 : nr;\n                  ng = ng < 0 ? 0 : ng > 255 ? 255 : ng;\n                  nb = nb < 0 ? 0 : nb > 255 ? 255 : nb;\n\n                  data[idx + 0] = nr;\n                  data[idx + 1] = ng;\n                  data[idx + 2] = nb;\n                  data[idx + 3] = 255;\n                }\n              }\n              return _context3.abrupt(\"break\", 24);\n\n            case 20:\n              for (_x8 = 0; _x8 < tempData.width; _x8++) {\n                for (_y = 0; _y < tempData.height; _y++) {\n                  _idx = (_x8 + _y * tempData.width) * 4;\n                  midx = (tempData.width - 1 - _x8 + _y * tempData.width) * 4;\n\n\n                  data[midx + 0] = data[_idx + 0];\n                  data[midx + 1] = data[_idx + 1];\n                  data[midx + 2] = data[_idx + 2];\n                  data[midx + 3] = 255;\n                }\n              }\n              return _context3.abrupt(\"break\", 24);\n\n            case 22:\n              for (_x9 = 0; _x9 < tempData.width; _x9++) {\n                for (_y2 = 0; _y2 < tempData.height; _y2++) {\n                  // Index of the pixel in the array\n                  _idx2 = (_x9 + _y2 * tempData.width) * 4;\n\n                  for (subCol = -2; subCol <= 2; subCol++) {\n                    colOff = subCol + _x9;\n\n                    if (colOff < 0 || colOff >= tempData.width) {\n                      colOff = 0;\n                    }\n                    for (subRow = -2; subRow <= 2; subRow++) {\n                      rowOff = subRow + _y2;\n\n                      if (rowOff < 0 || rowOff >= tempData.height) {\n                        rowOff = 0;\n                      }\n                      idx2 = (colOff + rowOff * tempData.width) * 4;\n                      _r3 = tempData.data[idx2 + 0];\n                      _g3 = tempData.data[idx2 + 1];\n                      _b3 = tempData.data[idx2 + 2];\n\n                      sumred += _r3;\n                      sumgreen += _g3;\n                      sumblue += _b3;\n                    }\n                  }\n\n                  // calculate new RGB value\n                  _nr = sumred / 25.0;\n                  _ng = sumgreen / 25.0;\n                  _nb = sumblue / 25.0;\n\n                  // clear previous for next pixel point\n\n                  sumred = 0.0;\n                  sumgreen = 0.0;\n                  sumblue = 0.0;\n\n                  // assign new pixel value\n                  data[_idx2 + 0] = _nr; // Red channel\n                  data[_idx2 + 1] = _ng; // Green channel\n                  data[_idx2 + 2] = _nb; // Blue channel\n                  data[_idx2 + 3] = 255; // Alpha channel\n                }\n              }\n              return _context3.abrupt(\"break\", 24);\n\n            case 24:\n              this.filterCtx.putImageData(imageData, 0, 0, 0, 0, this.filterCanvas.width, this.filterCanvas.height);\n              _context3.next = 27;\n              return this.getUrl({ outputType: outputType, suffix: suffix, canvas: this.filterCanvas });\n\n            case 27:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 28:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n\n    function transFormImageData(_x5, _x6, _x7) {\n      return _ref11.apply(this, arguments);\n    }\n\n    return transFormImageData;\n  }();\n  /**\n   * 图片滤镜\n   * @param {Object} options\n   * @param {String} mode 滤镜名字 非必须 默认 复古 'vintage'\n   */\n\n\n  photoMagician.prototype.addImageFilter = function () {\n    var _ref12 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n      var _ref13 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref13.cover,\n          _ref13$mode = _ref13.mode,\n          mode = _ref13$mode === undefined ? this.imageFilterType[\"vintage\"] : _ref13$mode,\n          outputType = _ref13.outputType;\n\n      var imageFilterConfig, _ref14, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              imageFilterConfig = Object.values(this.imageFilterType);\n\n              if (imageFilterConfig.includes(mode)) {\n                _context4.next = 3;\n                break;\n              }\n\n              throw new Error(\"mode must one of [\" + imageFilterConfig.join(\",\") + \"]\");\n\n            case 3:\n              _context4.next = 5;\n              return this.createImageNode(cover);\n\n            case 5:\n              _ref14 = _context4.sent;\n              img = _ref14.img;\n              suffix = _ref14.suffix;\n\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              return _context4.abrupt(\"return\", this.transFormImageData(mode, suffix, outputType));\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n\n    function addImageFilter() {\n      return _ref12.apply(this, arguments);\n    }\n\n    return addImageFilter;\n  }();\n  /**\n   * 旋转图片\n   * @param {String | Object} cover 图片\n   * @param {Number} rotate 旋转比例 (0 -360 ) deg\n   */\n\n\n  photoMagician.prototype.rotateImage = function () {\n    var _ref15 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n      var _ref16 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref16.cover,\n          _ref16$rotate = _ref16.rotate,\n          rotate = _ref16$rotate === undefined ? 0 : _ref16$rotate,\n          outputType = _ref16.outputType;\n\n      var _ref17, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (Object.is(typeof rotate === \"undefined\" ? \"undefined\" : _typeof(rotate), \"number\")) {\n                _context5.next = 2;\n                break;\n              }\n\n              throw new Error(\"rotate must be a number.\");\n\n            case 2:\n              _context5.next = 4;\n              return this.createImageNode(cover);\n\n            case 4:\n              _ref17 = _context5.sent;\n              img = _ref17.img;\n              suffix = _ref17.suffix;\n\n              this.ctx.save();\n              this.ctx.rotate(rotate * Math.PI / 180);\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              this.ctx.restore();\n              _context5.next = 13;\n              return this.getUrl({ outputType: outputType, suffix: suffix });\n\n            case 13:\n              return _context5.abrupt(\"return\", _context5.sent);\n\n            case 14:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    function rotateImage() {\n      return _ref15.apply(this, arguments);\n    }\n\n    return rotateImage;\n  }();\n  /**\n   * 图片 转base64\n   * @param {Object} options\n   * @param {String | Object} cover 图片地址\n   * @return 图片base64 data\n   */\n\n\n  photoMagician.prototype.toBase64Url = function () {\n    var _ref18 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee6(_ref19) {\n      var cover = _ref19.cover,\n          outputType = _ref19.outputType;\n\n      var _ref20, img, suffix;\n\n      return _regenerator2.default.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return this.createImageNode(cover);\n\n            case 2:\n              _ref20 = _context6.sent;\n              img = _ref20.img;\n              suffix = _ref20.suffix;\n\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              _context6.next = 8;\n              return this.getUrl({ outputType: outputType, suffix: suffix });\n\n            case 8:\n              return _context6.abrupt(\"return\", _context6.sent);\n\n            case 9:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    function toBase64Url(_x12) {\n      return _ref18.apply(this, arguments);\n    }\n\n    return toBase64Url;\n  }();\n  /**\n   * 压缩图片\n   * @param {Object} options\n   * @param {String | Object} cover 图片地址 | 图片节点 必选\n   * @param {Number}  quality 压缩比例  非必选 默认 '0.92'\n   * @return 压缩后的图片节点\n   */\n\n\n  photoMagician.prototype.compressImage = function () {\n    var _ref21 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n      var _ref22 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref22.cover,\n          _ref22$quality = _ref22.quality,\n          quality = _ref22$quality === undefined ? 0.92 : _ref22$quality,\n          outputType = _ref22.outputType;\n\n      var _ref23, img, _quality, suffix;\n\n      return _regenerator2.default.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (Object.is(typeof quality === \"undefined\" ? \"undefined\" : _typeof(quality), \"number\")) {\n                _context7.next = 2;\n                break;\n              }\n\n              throw new Error(\"quality must be a number.\");\n\n            case 2:\n              _context7.next = 4;\n              return this.createImageNode(cover);\n\n            case 4:\n              _ref23 = _context7.sent;\n              img = _ref23.img;\n\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              _quality = Number(quality);\n              suffix = _quality === 0.92 ? \"png\" : \"jpeg\";\n              _context7.next = 11;\n              return this.getUrl({ outputType: outputType, suffix: suffix, quality: _quality });\n\n            case 11:\n              return _context7.abrupt(\"return\", _context7.sent);\n\n            case 12:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    function compressImage() {\n      return _ref21.apply(this, arguments);\n    }\n\n    return compressImage;\n  }();\n\n  photoMagician.prototype.getPrimaryColor = function () {\n    var _ref24 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n      var _ref25 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          cover = _ref25.cover;\n\n      var _ref26, img, _ctx$getImageData, data, imgDataWidth, imgDataHeight, section, i, len, _ref27, r, g, b, a, rgba;\n\n      return _regenerator2.default.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return this.createImageNode(cover);\n\n            case 2:\n              _ref26 = _context8.sent;\n              img = _ref26.img;\n\n              this.ctx.drawImage(img, 0, 0, img.width, img.height);\n              _ctx$getImageData = this.ctx.getImageData(0, 0, img.width, img.height), data = _ctx$getImageData.data, imgDataWidth = _ctx$getImageData.width, imgDataHeight = _ctx$getImageData.height;\n              section = imgDataWidth * imgDataHeight;\n\n              for (i = 0, len = section; i < len; i++) {\n                _ref27 = [data[i * 4], data[i * 4 + 1], data[i * 4 + 2], data[i * 4 + 3]], r = _ref27[0], g = _ref27[1], b = _ref27[2], a = _ref27[3];\n                rgba = \"rgba(\" + r + \",\" + g + \",\" + b + \",\" + a + \")\";\n\n\n                if (this.colors[rgba]) {\n                  this.colors[rgba].num++;\n                } else {\n                  this.colors[rgba] = { color: rgba, num: 1 };\n                }\n              }\n              return _context8.abrupt(\"return\", this.getMaxPixelDensity(this.colors));\n\n            case 9:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8, this);\n    }));\n\n    function getPrimaryColor() {\n      return _ref24.apply(this, arguments);\n    }\n\n    return getPrimaryColor;\n  }();\n\n  photoMagician.prototype.getMaxPixelDensity = function getMaxPixelDensity(data) {\n    var sort = Object.values(data).sort(function (a, b) {\n      return a.num - b.num;\n    });\n    return sort[sort.length - 1][\"color\"];\n  };\n\n  return photoMagician;\n}();\n\nexports.default = photoMagician;"],"mappings":"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"},"metadata":{},"sourceType":"script"}